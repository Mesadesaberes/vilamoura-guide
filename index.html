<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vilamoura Guide Pro</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCqRtZgE7hw-znacoAqXuXZ4SEGVuXWudo&libraries=places"></script>

    <style>
        body, html { margin: 0; padding: 0; height: 100vh; width: 100%; overflow: hidden; background: #f4f7f9; font-family: 'Segoe UI', sans-serif; }
        
        .lang-bar { background: #003366; display: flex; justify-content: center; gap: 5px; padding: 8px; border-bottom: 2px solid #c5a059; height: 35px; }
        .lang-btn { background: rgba(255,255,255,0.1); border: 1px solid #fff; color: #fff; padding: 3px 6px; border-radius: 8px; cursor: pointer; font-size: 10px; font-weight: bold; }
        .lang-btn.active { background: #c5a059; border-color: #c5a059; }

        #main-container { height: calc(100vh - 51px); position: relative; overflow-y: auto; }

        .search-area { padding: 10px 15px; background: #f4f7f9; }
        .search-box-wrapper { position: relative; width: 100%; }
        .search-box-wrapper input { width: 100%; padding: 10px 35px; border-radius: 20px; border: 1px solid #ddd; box-shadow: 0 2px 8px rgba(0,0,0,0.1); box-sizing: border-box; }
        .search-icon { position: absolute; left: 12px; top: 11px; color: #888; }

        .grid-cats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px 15px 80px 15px; }
        .cat-card { background: #fff; border-radius: 12px; text-align: center; padding: 15px 5px; box-shadow: 0 3px 6px rgba(0,0,0,0.05); cursor: pointer; border: 1px solid #eee; }
        
        .footer-explore { position: fixed; bottom: 0; left: 0; right: 0; padding: 15px; background: linear-gradient(transparent, #f4f7f9 20%); text-align: center; }
        .btn-explore { width: 90%; padding: 12px; border-radius: 25px; background: #27ae60; color: #fff; border: none; font-weight: bold; font-size: 14px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        .btn-menu-fixo { position: absolute; top: 15px; left: 15px; z-index: 9999; padding: 10px 20px; border-radius: 25px; background: #003366; color: #fff; border: 2px solid #fff; font-weight: bold; }
        
        .item-row { display: flex; gap: 12px; background: #fff; padding: 10px; border-radius: 12px; margin-bottom: 10px; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        #map-canvas { width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const i18n = {
          pt: { search: "Procurar...", enter: "ENTRAR", back: "VOLTAR", walk: "ROTA A P√â", call: "LIGAR", explore: "üìç EXPLORAR TUDO", cats: { hoteis: "Hot√©is", comer: "Comer", bares: "Bares", lazer: "Lazer", golf: "Golf", lojas: "Lojas", imobiliarias: "Im√≥veis", util: "√ötil" } },
          en: { search: "Search...", enter: "ENTER", back: "BACK", walk: "WALK", call: "CALL", explore: "üìç EXPLORE ALL", cats: { hoteis: "Hotels", comer: "Eat", bares: "Bars", lazer: "Leisure", golf: "Golf", lojas: "Shops", imobiliarias: "Property", util: "Useful" } },
          fr: { search: "Chercher...", enter: "ENTRER", back: "RETOUR", walk: "MARCHER", call: "APPELER", explore: "üìç TOUT VOIR", cats: { hoteis: "H√¥tels", comer: "Manger", bares: "Bars", lazer: "Loisirs", golf: "Golf", lojas: "Boutiques", imobiliarias: "Immo", util: "Utile" } },
          de: { search: "Suche...", enter: "EINTRETEN", back: "ZUR√úCK", walk: "GEHEN", call: "ANRUFEN", explore: "üìç ALLES SEHEN", cats: { hoteis: "Hotels", comer: "Essen", bares: "Bars", lazer: "Freizeit", golf: "Golf", lojas: "L√§den", imobiliarias: "Immo", util: "N√ºtzlich" } },
          es: { search: "Buscar...", enter: "ENTRAR", back: "VOLVER", walk: "CAMINAR", call: "LLAMAR", explore: "üìç EXPLORAR TODO", cats: { hoteis: "Hoteles", comer: "Comer", bares: "Bares", lazer: "Ocio", golf: "Golf", lojas: "Tiendas", imobiliarias: "Inmuebles", util: "√ötil" } }
        };

        const LOCAIS = [
            { id: "tivoli", nome: "Tivoli Marina", cat: "hoteis", sub: "5*", lat: 37.07433, lng: -8.12017, icon: "üè®", tel: "+351289303303", web: "https://www.tivolihotels.com", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgbuotHReCbbgAZXVruQoDzpVQWaZTeqsqIHnANJDswD4BO8OF-oV0nfHsMd-G9zcEpAnpa2FTJtw94Fv0RiGgucHGOtnWz0UdQhce_R5A3inLhytkobCXvrP3bYc8T95Lv03hLt98GIbujpIZeCkiyHt6UZamuoo3MSLhhSBf9nawoKk-12X-8-i4C7GH_/w453-h301/Tivoli_Marina_Vilamoura_.jpg", info: { pt: "Luxo sobre a Marina", en: "Luxury over the Marina", fr: "Luxe sur la Marina", de: "Luxus am Hafen", es: "Lujo en la Marina" } },
            { id: "hole19", nome: "19th Hole", cat: "bares", sub: "Sports Bar", lat: 37.0755, lng: -8.1192, icon: "üç∫", tel: "+351914928110", web: "https://19thholevilamoura.com", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhWj9XRveJ01eX0XP2aJEuv-ECFUsDuigj5UD0KFVb-Kql5SgHo_lAQHS3LHREucUUi3Udwo06i2DJMKuky_1FQsYksvc27QAt7GfXwGb2166ylUrHDYhopxvS0hTh0Mid0tmgdmMoWo-JNqAsAI9DLizYbZrz8jAgNDAes-NKdwHT2P4UDV8kltccGE2o/w450-h234/19th%20HOLE.jpg", info: { pt: "Melhores Cocktails", en: "Best Cocktails", fr: "Meilleurs Cocktails", de: "Beste Cocktails", es: "Mejores C√≥cteles" } },
            { id: "ampalius", nome: "Vila Gal√© Ampalius", cat: "hoteis", sub: "4*", lat: 37.0773, lng: -8.1179, icon: "üè®", tel: "+351289303970", web: "https://www.vilagale.com", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhGVY9LR4Vy8uzfLr-M1OUhJ9VUCAYWg0OAbCOvXzoHhKTxr_3pvfa9I7eCk0tF6P8cHL35VyfCzFb7ZoVcwl-jCBhAdfa_zUuqgTXqnqUPBnZByM_x1lAO32VhpEJQiWGmcE9SbTAd-3AyGxWvJfXoajE0bw7W30cJHf95nymYA9ll8fQrUXD8usF5Fsms/w462-h307/Vila%20Gale%20Ampalius.jfif", info: { pt: "Frente √† praia", en: "Beachfront", fr: "Face √† la plage", de: "Direkt am Strand", es: "Frente a la playa" } },
            { id: "colombo", nome: "Colombo", cat: "comer", sub: "PT", lat: 37.0757, lng: -8.1150, icon: "üç¥", tel: "+351289300919", web: "https://facebook.com/restaurantecolombo", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh8BrDSbJXJaPu4G5ahigmv5fnnO71cxKiQfxiJmAZe-jgUcX3cQQG6XXzP0sCgRO_W4jFbfBDytY2oRqaBSWmV8nOkSkapWCvRtFgwPTTGK7PoDNVs_mTeDW11iP_QIo2iwxRtvhkLbjwIRjuUI340anqpR5UchWkRLqQCvsBo0X7gPv97dDZ7xifW0uWY/s1600/20220930_194648.jpg", info: { pt: "Cozinha tradicional", en: "Traditional cuisine", fr: "Cuisine traditionnelle", de: "Traditionelle K√ºche", es: "Cocina tradicional" } },
            { id: "oldcourse", nome: "Old Course", cat: "golf", sub: "Dom Pedro", lat: 37.1021, lng: -8.1155, icon: "üèåÔ∏è", tel: "+351289310341", web: "https://dompedrogolf.com", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi9TeufNw3s8cvFQCBMyEjurQCvim1PTN9Pgyp-wEehCZJXBgRNmvWMjjFIpwhWnbQu_jZ-s-7D8ufYQQTmccDbObpt4yIia1-xm3k0d1NiDCUORo_QIZkmFBmR4Z6dfxo7vWdHh538CPfO8Ar5SOfadBxHptQ0RDSUVp-hPaKJaSecDb5Q2WhPDzR8yOji/s320/old-course-with-logo.jpg", info: { pt: "Campo Cl√°ssico", en: "Classic Course", fr: "Parcours classique", de: "Klassischer Platz", es: "Campo Cl√°sico" } },
            { id: "thai", nome: "Thai Vilamoura", cat: "comer", sub: "Thai", lat: 37.0777, lng: -8.1163, icon: "üç≤", tel: "+351289302370", web: "https://thaivilamoura.com", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhLkC9YJrcg-dbSNHxYMSOEZBOF7CYin0QUJru5O_7Uqk5-mK2-66Ehv-0i5Mami3TCfsSGYDMkGKPfKskK8nhMRezn0WSeLwvtPjUnC43q6NDbyV1MoYGhHqxjxrHr7Dz6vX7Xh_kbuG_XJRgwJpZjVHBBBbjEuANxjQWzoFbx-88s9Ru-dR7kLhvWT4wU/w438-h640/Thai%20Vilamoura.jpg", info: { pt: "Comida Tailandesa", en: "Thai Food", fr: "Cuisine Tha√Ølandaise", de: "Thail√§ndisches Essen", es: "Comida Tailandesa" } },
            { id: "luna", nome: "Luna Rossa", cat: "comer", sub: "IT", lat: 37.0792, lng: -8.1195, icon: "üçï", tel: "+351289302245", web: "https://lunarossavilamoura.pt", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi7_h6rzfvQ3Q71fpNCPBew1q4d2OZBVTFoRENdwJDTV2u7iCf3ETpWdUxLmcooLKWxwxlh618mshG-iRA0-8myM5bihvdhSgC_XPi4o9ImPBpg3DdWITFFTkgbDDZkaVxRDRxol8Q4Mg_6nVJ8a57CXL-esH305eyVSBAGAO_BSNDXjez-IXrfZS4waxQp/w444-h313/Luna%20rossa.jpg", info: { pt: "Pizzas artesanais", en: "Artisan pizzas", fr: "Pizzas artisanales", de: "Hausgemachte Pizza", es: "Pizzas artesanales" } },
            { id: "clover", nome: "Golden Clover", cat: "bares", sub: "Irish", lat: 37.0752, lng: -8.1154, icon: "üçÄ", tel: "+351912432626", web: "https://goldenclover.pt", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgbb12_0MDt5KGaWQU-NNZ1lOnRmMMXbEp8zPQKhxJ-6tDmbmHdKEh4MjR-qWlEdPmJ1i1SKOkXi9eQ4nYosgR54knP9pcGt6_AOf-YBmkMGZdBc_FYWfY5KWkzyhdWCTZblDWalkekC06h4AwE7kmTfoGs-Y0793B5ncVuxDd9CFkSfGkh4RyV1dG-JAou/w447-h307/Golden%20Clover.jpg", info: { pt: "Cerveja e divers√£o", en: "Beer and fun", fr: "Bi√®re et plaisir", de: "Bier und Spa√ü", es: "Cerveza y diversi√≥n" } },
            { id: "familygolf", nome: "Family Golf Park", cat: "lazer", sub: "Golf", lat: 37.0780, lng: -8.1130, icon: "‚õ≥", tel: "+351289300440", web: "https://familygolfpark.pt", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjc3NgjlKZyOeGyESAgI1eDyS_CQahtDMlgphkwWDbl_hGajxBW3G8_6FwV704I6RT3y1U3WVmwlAxLqHRxDJbONvxP253ROq627_Dr19tpB7GR1R09Qz3Oo3S8ljIDjSM8AH_7v-ULFNvJR_clp0owjNlbIyHinnoqlpSso9wz5nxbSolX8Nld6dvCafJ7/s320/family-golf-park.jpg", info: { pt: "Lazer familiar", en: "Family leisure", fr: "Loisirs en famille", de: "Freizeit f√ºr Familien", es: "Ocio familiar" } },
            { id: "museu", nome: "Cerro da Vila", cat: "lazer", sub: "Museu", lat: 37.0801, lng: -8.1190, icon: "üèõÔ∏è", tel: "+351289312153", web: "https://museucerro-davila.pt", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjcJRzVqg8sBXmR4Ru_tJ_h8uvMBytfsKq0ZcyyhVv_vMqwV5g9_ECx8Qpzo0CAec4qHUBt2-3kfQ2oqds4HoZfp3iqWHI77lWV6S96XYk2LjdfPinmNIFBOfWGGOdMNDOHq_wJe8H-LCyZAbnTKA_Cpw7nkaY21YAcWGWN8uSmy7ZJpgrT9yeDOxPrzj3k/s1600/Museu%20cerro%20da%20Vila.jfif", info: { pt: "Ru√≠nas Romanas", en: "Roman Ruins", fr: "Ruines romaines", de: "R√∂mische Ruinen", es: "Ruinas Romanas" } },
            { id: "casino", nome: "Casino Vilamoura", cat: "lazer", sub: "Shows", lat: 37.0773, lng: -8.1156, icon: "üé∞", tel: "+351289310000", web: "https://solverde.pt", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQ2NGpAkrZA6JF3mdjzj45f_wn6vEprsp-W3o3KUe3402dmvVvux3Z3hbWnRPns2QRjk-4-AFWfLlGz6XQcAPb41BZO5dQQClIHiHoJSHm_Lka7Ui1kQeR2c-ye_-DkFgc-IKomAWlhbqNFS74yo-Hm6QoXdBVWTiBv9X9Pob-O3TwJzEsSi2JlfHx-oIA/w465-h261/Casino-de-vilamoura.jfif", info: { pt: "Shows e Jogos", en: "Shows and Games", fr: "Spectacles et Jeux", de: "Shows und Spiele", es: "Espect√°culos y Juegos" } },
            { id: "millennium", nome: "Millennium Golf", cat: "golf", sub: "Dom Pedro", lat: 37.1030, lng: -8.1250, icon: "‚õ≥", tel: "+351289310333", web: "https://dompedrogolf.com", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEih8kW5HMhTxRlM1XIUrZ4TSciEfZrsvRW4F5roCad245G8zd5RW7GB_SC0CkyaGH0Oty_56EmTfnZxCxjLLXQET_LhHHAKHbYmPgBFMpJFvkq-ngPBWoU4SJzxqI2CyuIQaVg2BroRKbvBoMpzniycJ2r1wbY9OW4oDvKtG7iftq8WImThBLQANgLd5KNx/s1600/millennium-golf-with-logo-.jpg", info: { pt: "Design Moderno", en: "Modern Design", fr: "Design moderne", de: "Modernes Design", es: "Dise√±o Moderno" } },
            { id: "laguna", nome: "Laguna Golf", cat: "golf", sub: "Dom Pedro", lat: 37.1050, lng: -8.1300, icon: "‚õ≥", tel: "+351289310333", web: "https://dompedrogolf.com", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjpqruYU498m27vVpXxHIMtt8C1ktkTH71CfBsUiAn6KeWWMb3L2dhVJ_sRsB8MqWImt1Nc7vHFm6N7ynWlPEWzvlkCAU_ckNVNh6YY2ZWgCuWGnxIZFWxzPlLjtREk8MnWG7YtU0cQSUb3wLvpSs-B6Uem8rzJ0qtOdwYGohE628cAG4UhvIWrhogBU-Hm/s320/laguna-golf-with-logo.jpg", info: { pt: "Estilo Links", en: "Links Style", fr: "Style Links", de: "Links-Stil", es: "Estilo Links" } },
            { id: "pinhal", nome: "Pinhal Golf", cat: "golf", sub: "Dom Pedro", lat: 37.0925, lng: -8.1105, icon: "‚õ≥", tel: "+351289310390", web: "https://dompedrogolf.com", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjmOHg_GgQCiwZ8Nzw0S2bZKA57EZd7Vaoy9Aj-qqmFWoRFnsZ4CON57mhqOozH0eVR_G37tJgibQo8etDAA2rvAlLJO4EP36RldXk2VbSF_ephlsiLUEOk6ASXHhJqZE6T-lPXNdrdodZ8zc37jnrjQvSYm9wIZGD50KwxjMVysb7v6uoSCa_khKeQsMOZ/s320/pinhal-Golf-with-logo.jpg", info: { pt: "Pinhal majestoso", en: "Majestic Pine", fr: "Pin√®de majestueuse", de: "Majest√§tischer Pinienwald", es: "Pinar majestuoso" } },
            { id: "victoria", nome: "Victoria Golf", cat: "golf", sub: "Dom Pedro", lat: 37.1035, lng: -8.1418, icon: "üèÜ", tel: "+351289310100", web: "https://dompedrogolf.com", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhE1xthVUNMfTBR0JzfDp-ROZxgt68NTwsBLyfIW2U0yg_pXH5WqcYXJ3trnAQN1CHmsoX30d6TsoU1gHoi_sxcWJbDLcgQ8gM9DIl-pRs0Mz6fXBDfBPDKenIohFgPSwID2r_CyKciRyvMsBgAi7FXlyQcHdL_lYWUb6ahWrsqz4FuWFA6Tuc-Ok_nv_Pc/w319-h319/Victoria%20Golf.png", info: { pt: "Arnold Palmer", en: "Arnold Palmer Design", fr: "Design Arnold Palmer", de: "Arnold Palmer Design", es: "Dise√±o Arnold Palmer" } },
            { id: "algarveprop", nome: "AlgarveProperty", cat: "imobiliarias", sub: "1997", lat: 37.07666, lng: -8.11777, icon: "üè†", tel: "+351289310310", web: "https://algarveproperty.com", img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSVzBUZBmk6gabC9cgFgvLm0HewvEvduKo91A&s", info: { pt: "Especialistas", en: "Specialists", fr: "Sp√©cialistes", de: "Spezialisten", es: "Especialistas" } },
            { id: "garvetur", nome: "Garvetur Marina", cat: "imobiliarias", sub: "Immo", lat: 37.07530, lng: -8.11857, icon: "üè¢", tel: "+351289322444", web: "https://garvetur.pt", img: "https://images.trvl-media.com/lodging/4000000/3920000/3915300/3915273/d80a3261.jpg?impolicy=resizecrop&rw=575&rh=575&ra=fill", info: { pt: "Venda e Aluguer", en: "Sales and Rentals", fr: "Ventes et Locations", de: "Verkauf und Vermietung", es: "Venta y Alquiler" } },
            { id: "gnr", nome: "GNR Vilamoura", cat: "util", sub: "Pol√≠cia", lat: 37.08552, lng: -8.11651, icon: "üöì", tel: "+351289381550", web: "https://gnr.pt", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQgNFxLWvwZnkV9I4cIlNTLi93LFVaWr3y2oVgyPoGt87EBiETjT2ZT2Jw-XxMOEco59kpDHgwKAympVvrrtSXTvk1pTEh13ZH_OOl3nbDQLtryq1QepMEPz_sve47DwMPwbgINSkmnIajW9R2VQT9lX7Wu4_VeEY-NdO2_Ib_3uuAwjZj6EExkUsETE3f/s320/GNR.jpg", info: { pt: "Seguran√ßa 24h", en: "24h Security", fr: "S√©curit√© 24h", de: "24h Sicherheit", es: "Seguridad 24h" } },
            { id: "farmacia", nome: "Farm√°cia Silva", cat: "util", sub: "Sa√∫de", lat: 37.08317, lng: -8.11817, icon: "üíä", tel: "+351289312878", web: "https://farmaciasilva.pt", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEitgXmGISsEp162r5_7dhZN7VIJbr7e_5zkpTrsWtG_SSMdcSL1sYU0c8x7kYpY3rP_zQK1F1BxYNmRwQ77N5UaiPCU0XOf33uTmJwDfo6_tjENtNSCy5nmqCmy0hTg5QchCRT6Jbjd-IDpqcd6ZSR4Hh9muRfbyuAaEnsxMS7O5L_km4lFG2nQZaV-zKKd/s1600/Farm%C3%A1cia%20Silva%20Vilamoura.jfif", info: { pt: "Sa√∫de e Bem-estar", en: "Health and Wellness", fr: "Sant√© et Bien-√™tre", de: "Gesundheit", es: "Salud" } },
            { id: "samba", nome: "Samba Boutique", cat: "lojas", sub: "Moda", lat: 37.0768, lng: -8.1180, icon: "üõçÔ∏è", tel: "+351289314332", web: "https://facebook.com/sambavilamoura", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgYiHBQegN1seH4WuXdirY0CZQT077YwYDFcGeXxcrAVY9ve3PKX4mso-PBRBMJ7X29J_oD1TwZAudavFaq0rpxU8t24mNp_QtBcDXY-HEhyZHnsqOE4YEG5c-SGuyuW613Lr52PjdLwx2uRLCdLb50Ee69pFyfMlkgEkNUzuKfQM-MMazgOUGrkmsPmyOP/w400-h286/Samba%20Marina%20Vilamoura.jpg", info: { pt: "Moda Feminina", en: "Womens Fashion", fr: "Mode f√©minine", de: "Damenmode", es: "Moda Femenina" } }
        ];

        const CATEGORIAS = [
          { id: 'hoteis', icon: 'fa-hotel' }, { id: 'comer', icon: 'fa-utensils' },
          { id: 'bares', icon: 'fa-glass-cheers' }, { id: 'lazer', icon: 'fa-camera-retro' },
          { id: 'golf', icon: 'fa-golf-ball-tee' }, { id: 'lojas', icon: 'fa-bag-shopping' },
          { id: 'imobiliarias', icon: 'fa-house-chimney' }, { id: 'util', icon: 'fa-shield-halved' }
        ];

        function App() {
          const [lang, setLang] = useState('pt');
          const [view, setView] = useState('splash');
          const [catAtiva, setCatAtiva] = useState(null);
          const [gMap, setGMap] = useState(null);
          const [query, setQuery] = useState('');
          const mapRef = useRef(null);
          const dirRen = useRef(null);
          const dirSer = useRef(null);
          const markersRef = useRef([]);

          const t = i18n[lang];

          useEffect(() => {
            if (view === 'mapa' && !gMap) {
              const m = new google.maps.Map(mapRef.current, { 
                center: { lat: 37.076, lng: -8.118 }, 
                zoom: 15, 
                disableDefaultUI: true 
              });
              dirSer.current = new google.maps.DirectionsService();
              dirRen.current = new google.maps.DirectionsRenderer({ map: m });
              setGMap(m);
            }
          }, [view]);

          // IMPORTANTE: Redesenha o mapa quando ele aparece
          useEffect(() => {
            if(gMap && view === 'mapa') {
                google.maps.event.trigger(gMap, 'resize');
            }
          }, [view, gMap]);

          const renderMarkers = (list) => {
            if(!gMap) return;
            markersRef.current.forEach(m => m.setMap(null));
            markersRef.current = [];
            
            list.forEach(loc => {
              const mark = new google.maps.Marker({
                position: { lat: loc.lat, lng: loc.lng },
                map: gMap,
                label: { text: loc.icon, color: '#fff', fontSize: '14px' },
                icon: { path: google.maps.SymbolPath.CIRCLE, scale: 16, fillColor: '#003366', fillOpacity: 1, strokeWeight: 2, strokeColor: '#fff' }
              });
              
              mark.addListener("click", () => {
                new google.maps.InfoWindow({
                  content: `<div style="width:180px; font-family:sans-serif;">
                    <img src="${loc.img}" style="width:100%;border-radius:5px;"/>
                    <h4 style="margin:5px 0; color:#003366;">${loc.nome}</h4>
                    <p style="font-size:11px;">${loc.info[lang]}</p>
                    <button onclick="window.calcRoute(${loc.lat},${loc.lng})" style="background:#27ae60;color:#fff;padding:8px;width:100%;border:none;border-radius:5px;font-weight:bold;cursor:pointer;">${t.walk}</button>
                  </div>`
                }).open(gMap, mark);
              });
              markersRef.current.push(mark);
            });
          };

          const handleSelectLoc = (item) => {
            setView('mapa');
            setTimeout(() => {
                renderMarkers(item ? [item] : LOCAIS);
                if(item && gMap) gMap.panTo({ lat: item.lat, lng: item.lng });
            }, 100);
          };

          window.calcRoute = (lat, lng) => {
            navigator.geolocation.getCurrentPosition(pos => {
              dirSer.current.route({
                origin: { lat: pos.coords.latitude, lng: pos.coords.longitude },
                destination: { lat, lng }, travelMode: google.maps.TravelMode.WALKING
              }, (r, s) => { if (s === 'OK') dirRen.current.setDirections(r); });
            });
          };

          const filtered = LOCAIS.filter(l => l.nome.toLowerCase().includes(query.toLowerCase()));

          return (
            <div style={{height: '100%'}}>
              <div className="lang-bar">
                {['pt','en','fr','de','es'].map(l => (
                  <button key={l} className={`lang-btn ${lang === l ? 'active' : ''}`} onClick={() => setLang(l)}>{l.toUpperCase()}</button>
                ))}
              </div>

              <div id="main-container">
                {view === 'splash' && (
                  <div style={{ height: '100%', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', background: '#003366' }}>
                    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgcgTG65bbe2IDQQJzNptqaWtHiqAD2kQBDMa2QWhC94gD10X21cB-LrH4gtHgscfjXFO6Fq1MS8Qg9tOE-kVKAjUe-4h7sNUMRduS_05lNMKEuaG4ABJntJWd5TPpB6OKOvkAnYFjpEPmjaodtdbxdMShpC4jw2wkNU-75-SV7dLdXgTvCWJNv0ro3oBYi/s320/Vilamoura_Guide_Logo.gif" style={{ width: '70%', borderRadius: '20px' }} />
                    <button onClick={() => setView('menu')} style={{ marginTop: '40px', padding: '15px 60px', borderRadius: '30px', background: '#fff', color: '#003366', border: 'none', fontWeight: 'bold' }}>{t.enter}</button>
                  </div>
                )}

                {view === 'menu' && (
                  <>
                    <div className="search-area">
                        <div className="search-box-wrapper">
                            <i className="fas fa-search search-icon"></i>
                            <input type="text" placeholder={t.search} value={query} onChange={(e) => setQuery(e.target.value)} />
                        </div>
                    </div>
                    
                    {query.length > 0 ? (
                        <div style={{padding: '0 15px'}}>
                            {filtered.map(l => (
                                <div key={l.id} className="item-row" onClick={() => handleSelectLoc(l)}>
                                    <img src={l.img} style={{width:'50px', height:'50px', objectFit:'cover', borderRadius:'8px'}} />
                                    <div><div style={{fontWeight:'bold', color:'#003366'}}>{l.nome}</div><div style={{fontSize:'12px', color:'#777'}}>{l.info[lang]}</div></div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="grid-cats">
                          {CATEGORIAS.map(c => (
                            <div key={c.id} onClick={() => { setCatAtiva(c.id); setView('lista'); }} className="cat-card">
                              <i className={`fas ${c.icon}`} style={{ fontSize: '24px', color: '#003366' }}></i>
                              <div style={{ marginTop: '8px', fontSize: '13px', fontWeight: 'bold', color: '#444' }}>{t.cats[c.id]}</div>
                            </div>
                          ))}
                        </div>
                    )}

                    <div className="footer-explore">
                        <button className="btn-explore" onClick={() => handleSelectLoc(null)}>{t.explore}</button>
                    </div>
                  </>
                )}

                {view === 'lista' && (
                  <div style={{padding: '15px'}}>
                    <button onClick={() => setView('menu')} style={{ marginBottom: '15px', border: 'none', background: 'none', color: '#003366', fontWeight: 'bold', fontSize: '16px' }}>‚Üê {t.back}</button>
                    {LOCAIS.filter(l => l.cat === catAtiva).map(l => (
                      <div key={l.id} onClick={() => handleSelectLoc(l)} className="item-row">
                        <img src={l.img} style={{ width: '60px', height: '60px', objectFit: 'cover', borderRadius: '5px' }} />
                        <div><div style={{ fontWeight: 'bold', color: '#003366' }}>{l.nome}</div><div style={{ fontSize: '12px', color: '#666' }}>{l.info[lang]}</div></div>
                      </div>
                    ))}
                  </div>
                )}

                {view === 'mapa' && (
                    <div style={{ width: '100%', height: '100%', position: 'relative' }}>
                        <button className="btn-menu-fixo" onClick={() => setView('menu')}>MENU</button>
                        <div ref={mapRef} id="map-canvas"></div>
                    </div>
                )}
              </div>
            </div>
          );
        }
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
