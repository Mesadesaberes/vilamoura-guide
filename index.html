<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vilamoura Select</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#003366">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Vilamoura Select">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCqRtZgE7hw-znacoAqXuXZ4SEGVuXWudo&libraries=places"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        body, html { margin: 0; padding: 0; height: 100vh; width: 100%; overflow: hidden; background: #f4f7f9; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #root { height: 100%; width: 100%; }
        
        .splash-screen { 
            position: fixed; 
            inset: 0; 
            background: #ffffff; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            z-index: 1000; 
            box-sizing: border-box;
            overflow: hidden;
        }

        .welcome-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #003366 0%, #004080 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            padding: 30px 20px;
            box-sizing: border-box;
            color: #ffffff;
            overflow-y: auto;
        }

        .welcome-content {
            max-width: 380px;
            text-align: center;
            width: 100%;
        }

        .welcome-logo {
            width: 100px;
            height: 100px;
            background: #ffffff;
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px auto;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .welcome-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .welcome-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #c5a059;
        }

        .welcome-text {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 25px;
            opacity: 0.95;
            max-width: 340px;
            margin-left: auto;
            margin-right: auto;
        }

        .lang-select-title {
            font-size: 11px;
            margin-bottom: 12px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
        }

        .lang-grid-flags {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .lang-flag-option {
            width: 42px;
            height: 34px;
            background: rgba(255,255,255,0.15);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .lang-flag-option:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.08);
        }

        .lang-flag-option.selected {
            background: rgba(197, 160, 89, 0.3);
            border-color: #c5a059;
            box-shadow: 0 0 12px rgba(197, 160, 89, 0.5);
        }

        .welcome-btn {
            width: 100%;
            max-width: 260px;
            padding: 14px 24px;
            background: #c5a059;
            color: #003366;
            border: none;
            border-radius: 28px;
            font-weight: bold;
            font-size: 15px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.25);
            transition: transform 0.2s;
            margin-bottom: 12px;
        }

        .welcome-btn:hover {
            transform: scale(1.03);
        }

        .welcome-checkbox {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 12px;
            opacity: 0.75;
            cursor: pointer;
        }

        .welcome-checkbox input {
            width: 16px;
            height: 16px;
            accent-color: #c5a059;
        }

        .lang-bar { background: #003366; display: flex; justify-content: center; gap: 4px; padding: 8px; border-bottom: 2px solid #c5a059; height: 45px; box-sizing: border-box; }
        .lang-btn { background: rgba(255,255,255,0.1); border: 1px solid #fff; color: #fff; padding: 4px 6px; border-radius: 6px; cursor: pointer; font-size: 10px; font-weight: bold; min-width: 40px; }
        .lang-btn.active { background: #c5a059; border-color: #c5a059; }

        .app-content { height: calc(100vh - 45px); position: relative; width: 100%; }
        .menu-view { height: 100%; overflow-y: auto; padding-bottom: 20px; box-sizing: border-box; }
        
        .search-area { padding: 15px; position: sticky; top: 0; background: #f4f7f9; z-index: 10; }
        .search-box { position: relative; }
        .search-box input { width: 100%; padding: 12px 40px; border-radius: 25px; border: 1px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.1); box-sizing: border-box; }
        .search-box i { position: absolute; left: 15px; top: 14px; color: #888; }

        .grid-cats { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 15px; }
        .cat-card { background: #fff; border-radius: 15px; text-align: center; padding: 20px 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; border: 1px solid #eee; }
        
        .explore-below-btn {
            width: 100%;
            max-width: 300px;
            padding: 12px;
            border-radius: 25px;
            background: #27ae60;
            color: white;
            border: none;
            font-weight: bold;
            cursor: pointer;
            margin: 20px auto 10px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        .map-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 20; background: white; }
        .btn-back-map { position: absolute; top: 15px; left: 15px; z-index: 30; padding: 10px 20px; border-radius: 25px; background: #003366; color: white; border: 2px solid white; font-weight: bold; }
        #map-canvas { width: 100%; height: 100%; }

        .item-row { display: flex; gap: 12px; background: #fff; padding: 12px; border-radius: 12px; margin: 0 15px 10px 15px; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; }
        
        .info-buttons { display: flex; flex-direction: column; gap: 6px; margin-top: 10px; }
        .btn-info { display: block; text-align: center; padding: 10px; border-radius: 6px; text-decoration: none; color: white; font-size: 11px; font-weight: bold; border: none; cursor: pointer; }
        .bg-blue { background: #003366; }
        .bg-green { background: #27ae60; }
        .bg-gold { background: #c5a059; }
        
        .loader { text-align: center; padding: 40px; color: #666; }
        .error-msg { text-align: center; padding: 20px; color: #c00; background: #ffe6e6; margin: 10px 15px; border-radius: 8px; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyDfUDqEJxVnWbQgn6LEVQAjlKeBJdp0vyY",
            authDomain: "vilamoura-select.firebaseapp.com",
            projectId: "vilamoura-select",
            storageBucket: "vilamoura-select.firebasestorage.app",
            messagingSenderId: "189990454398",
            appId: "1:189990454398:web:3d9eac9cf3a84b0510c42f",
            measurementId: "G-X73F6HT81C"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        const languages = [
            { code: 'pt', flag: 'https://flagcdn.com/w40/pt.png', name: 'Portugu√™s' },
            { code: 'en', flag: 'https://flagcdn.com/w40/gb.png', name: 'English' },
            { code: 'fr', flag: 'https://flagcdn.com/w40/fr.png', name: 'Fran√ßais' },
            { code: 'de', flag: 'https://flagcdn.com/w40/de.png', name: 'Deutsch' },
            { code: 'es', flag: 'https://flagcdn.com/w40/es.png', name: 'Espa√±ol' }
        ];

        const i18n = {
          pt: { 
            enter: "ENTRAR", 
            search: "Procurar...", 
            back: "VOLTAR", 
            route: "CALCULAR ROTA", 
            call: "LIGAR", 
            visit: "WEBSITE", 
            explore: "üìç EXPLORAR TUDO", 
            loading: "A carregar...", 
            welcome: "Bem-vindo", 
            welcomeText: "O seu guia independente para descobrir o melhor de Vilamoura. Selecione o seu idioma para come√ßar.", 
            selectLang: "Idioma", 
            start: "COME√áAR", 
            dontShowAgain: "N√£o mostrar novamente", 
            cats: { 
              hoteis: "Hot√©is", 
              comer: "Comer", 
              bares: "Bares", 
              lazer: "Lazer", 
              golf: "Golf", 
              lojas: "Lojas", 
              imobiliarias: "Im√≥veis", 
              util: "√ötil",
              transportes: "Transportes",
              experiencias: "Experi√™ncias"
            } 
          },
          en: { 
            enter: "ENTER", 
            search: "Search...", 
            back: "BACK", 
            route: "GET ROUTE", 
            call: "CALL", 
            visit: "WEBSITE", 
            explore: "üìç EXPLORE ALL", 
            loading: "Loading...", 
            welcome: "Welcome", 
            welcomeText: "Your independent guide to discover the best of Vilamoura. Select your language to begin.", 
            selectLang: "Language", 
            start: "GET STARTED", 
            dontShowAgain: "Don't show again", 
            cats: { 
              hoteis: "Hotels", 
              comer: "Eat", 
              bares: "Bars", 
              lazer: "Leisure", 
              golf: "Golf", 
              lojas: "Shops", 
              imobiliarias: "Property", 
              util: "Useful",
              transportes: "Transport",
              experiencias: "Experiences"
            } 
          },
          fr: { 
            enter: "ENTRER", 
            search: "Chercher...", 
            back: "RETOUR", 
            route: "ITIN√âRAIRE", 
            call: "APPELER", 
            visit: "SITE WEB", 
            explore: "üìç TOUT VOIR", 
            loading: "Chargement...", 
            welcome: "Bienvenue", 
            welcomeText: "Votre guide ind√©pendant pour d√©couvrir le meilleur de Vilamoura. S√©lectionnez votre langue pour commencer.", 
            selectLang: "Langue", 
            start: "COMMENCER", 
            dontShowAgain: "Ne plus afficher", 
            cats: { 
              hoteis: "H√¥tels", 
              comer: "Manger", 
              bares: "Bars", 
              lazer: "Loisirs", 
              golf: "Golf", 
              lojas: "Boutiques", 
              imobiliarias: "Immo", 
              util: "Utile",
              transportes: "Transports",
              experiencias: "Exp√©riences"
            } 
          },
          de: { 
            enter: "EINTRETEN", 
            search: "Suche...", 
            back: "ZUR√úCK", 
            route: "ROUTE BERECHNEN", 
            call: "ANRUFEN", 
            visit: "WEBSEITE", 
            explore: "üìç ALLES SEHEN", 
            loading: "Laden...", 
            welcome: "Willkommen", 
            welcomeText: "Ihr unabh√§ngiger Reisef√ºhrer, um das Beste von Vilamoura zu entdecken. W√§hlen Sie Ihre Sprache.", 
            selectLang: "Sprache", 
            start: "STARTEN", 
            dontShowAgain: "Nicht wieder anzeigen", 
            cats: { 
              hoteis: "Hotels", 
              comer: "Essen", 
              bares: "Bars", 
              lazer: "Freizeit", 
              golf: "Golf", 
              lojas: "L√§den", 
              imobiliarias: "Immo", 
              util: "N√ºtzlich",
              transportes: "Transport",
              experiencias: "Erlebnisse"
            } 
          },
          es: { 
            enter: "ENTRAR", 
            search: "Buscar...", 
            back: "VOLVER", 
            route: "CALCULAR RUTA", 
            call: "LLAMAR", 
            visit: "SITIO WEB", 
            explore: "üìç EXPLORAR TODO", 
            loading: "Cargando...", 
            welcome: "Bienvenido", 
            welcomeText: "Tu gu√≠a independiente para descubrir lo mejor de Vilamoura. Selecciona tu idioma para comenzar.", 
            selectLang: "Idioma", 
            start: "COMENZAR", 
            dontShowAgain: "No mostrar de nuevo", 
            cats: { 
              hoteis: "Hoteles", 
              comer: "Comer", 
              bares: "Bares", 
              lazer: "Ocio", 
              golf: "Golf", 
              lojas: "Tiendas", 
              imobiliarias: "Inmuebles", 
              util: "√ötil",
              transportes: "Transporte",
              experiencias: "Experiencias"
            } 
          }
        };

        const CATEGORIAS = [
          { id: 'hoteis', icon: 'fa-hotel' }, 
          { id: 'comer', icon: 'fa-utensils' },
          { id: 'bares', icon: 'fa-glass-cheers' }, 
          { id: 'lazer', icon: 'fa-camera-retro' },
          { id: 'golf', icon: 'fa-golf-ball-tee' }, 
          { id: 'lojas', icon: 'fa-bag-shopping' },
          { id: 'imobiliarias', icon: 'fa-house-chimney' }, 
          { id: 'util', icon: 'fa-shield-halved' },
          { id: 'transportes', icon: 'fa-bus' },
          { id: 'experiencias', icon: 'fa-ticket-alt' }
        ];

        const getInfoText = (info, lang) => {
            if (!info) return '';
            if (typeof info === 'object' && info[lang]) return info[lang];
            if (typeof info === 'object' && info.en) return info.en;
            if (typeof info === 'string') return info;
            return '';
        };

        const cleanImageUrl = (url) => {
            if (!url) return '';
            return url.trim().replace(/\s+/g, '');
        };

        function App() {
          const [view, setView] = useState('splash');
          const [lang, setLang] = useState('pt');
          const [subView, setSubView] = useState('grid');
          const [catAtiva, setCatAtiva] = useState(null);
          const [query, setQuery] = useState('');
          const [locais, setLocais] = useState([]);
          const [loading, setLoading] = useState(true);
          const [error, setError] = useState(null);
          const [dontShowAgain, setDontShowAgain] = useState(false);
          const [selectedLang, setSelectedLang] = useState('pt');
          
          const mapRef = useRef(null);
          const googleMap = useRef(null);
          const markers = useRef([]);
          const directionsRenderer = useRef(null);

          const t = i18n[lang] || i18n.en;

          useEffect(() => {
            const savedLang = localStorage.getItem('vilamoura_lang');
            if (savedLang) {
                setLang(savedLang);
                setSelectedLang(savedLang);
            }
          }, []);

          const handleEnter = () => {
            const hasSeenWelcome = localStorage.getItem('vilamoura_welcome_seen');
            if (hasSeenWelcome) {
                setView('menu');
            } else {
                setView('welcome');
            }
          };

          const handleStart = () => {
            if (dontShowAgain) {
                localStorage.setItem('vilamoura_welcome_seen', 'true');
            }
            localStorage.setItem('vilamoura_lang', selectedLang);
            setLang(selectedLang);
            setView('menu');
          };

          useEffect(() => {
            if (view === 'menu') {
                setLoading(true);
                setError(null);
                db.collection('locais').get()
                    .then((snapshot) => {
                        const dados = snapshot.docs.map(doc => doc.data());
                        setLocais(dados);
                        setLoading(false);
                        if (dados.length === 0) setError('Nenhum neg√≥cio encontrado.');
                    })
                    .catch((err) => {
                        console.error("Erro Firestore:", err);
                        setError('Erro ao carregar dados.');
                        setLoading(false);
                    });
            }
          }, [view]);

          useEffect(() => {
            if (view === 'menu' && !googleMap.current && mapRef.current) {
                googleMap.current = new google.maps.Map(mapRef.current, {
                    center: { lat: 37.076, lng: -8.118 },
                    zoom: 15,
                    disableDefaultUI: true,
                    styles: [
                        { featureType: "poi", elementType: "labels", stylers: [{ visibility: "off" }] },
                        { featureType: "transit", elementType: "labels", stylers: [{ visibility: "off" }] }
                    ]
                });
                directionsRenderer.current = new google.maps.DirectionsRenderer({
                    map: googleMap.current,
                    polylineOptions: { strokeColor: "#003366", strokeWeight: 5 }
                });
            }
          }, [view]);

          window.getInternalRoute = (lat, lng) => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    const service = new google.maps.DirectionsService();
                    service.route({
                        origin: { lat: pos.coords.latitude, lng: pos.coords.longitude },
                        destination: { lat: parseFloat(lat), lng: parseFloat(lng) },
                        travelMode: google.maps.TravelMode.WALKING
                    }, (result, status) => {
                        if (status === 'OK') directionsRenderer.current.setDirections(result);
                    });
                });
            }
          };

          const openMap = (items) => {
            setSubView('mapa');
            if(directionsRenderer.current) directionsRenderer.current.setDirections({routes: []});
            markers.current.forEach(m => m.setMap(null));
            const list = Array.isArray(items) ? items : [items];
            
            list.forEach(loc => {
                const marker = new google.maps.Marker({
                    position: { lat: loc.lat, lng: loc.lng },
                    map: googleMap.current,
                    label: { text: loc.icon || 'üìç', color: 'white' }
                });
                const infoText = getInfoText(loc.info, lang);
                const imgSrc = cleanImageUrl(loc.img);
                const content = `
                    <div style="width:200px; padding:5px;">
                        ${imgSrc ? `<img src="${imgSrc}" style="width:100%; border-radius:8px; min-height:120px; object-fit:cover;" onerror="this.src='https://via.placeholder.com/200x120?text=Sem+Foto'">` : ''}
                        <h3 style="margin:10px 0 5px 0; color:#003366; font-size:16px;">${loc.nome || 'Sem nome'}</h3>
                        <p style="font-size:12px; margin-bottom:10px; color:#666;">${infoText}</p>
                        <div class="info-buttons">
                            <button onclick="window.getInternalRoute(${loc.lat}, ${loc.lng})" class="btn-info bg-blue">${t.route}</button>
                            ${loc.tel ? `<a href="tel:${loc.tel}" class="btn-info bg-green">${t.call}</a>` : ''}
                            ${loc.web && loc.web !== '#' ? `<a href="${loc.web}" target="_blank" class="btn-info bg-gold">${t.visit}</a>` : ''}
                        </div>
                    </div>
                `;
                const iw = new google.maps.InfoWindow({ content });
                marker.addListener('click', () => iw.open(googleMap.current, marker));
                markers.current.push(marker);
            });
            if(!Array.isArray(items)) {
                googleMap.current.setCenter({lat: items.lat, lng: items.lng});
                googleMap.current.setZoom(17);
            } else {
                googleMap.current.setZoom(14);
                googleMap.current.setCenter({ lat: 37.076, lng: -8.118 });
            }
          };

          const filtered = locais.filter(l => l.nome && l.nome.toLowerCase().includes(query.toLowerCase()));

          // ‚úÖ SPLASH SCREEN
          if (view === 'splash') {
            return (
              <div className="splash-screen">
                <img 
                  src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh2RRJgYenNf-1LjVFu47Lj4dmOnLy9PPAcXvXN2zLle3kx2vlEAQXtIs6_C6g9H-90RCQqjSj41N6ZfeDT35GG17m8VJ3-h4iC041wDTLKTZJ7QAs5511gf8OimILN-XyQlT4v3Brs7yWpQSqL_DuvLKJrLvacbYvb7y9VZFEOyZ6FVTwLtPFtI_Xt5nZG/w400-h225/Vilamoura-Select_YourIndependentGuidetoVilamoura_retangular_2-.gif" 
                  alt="Vilamoura Select"
                  style={{ 
                    width: '95%',
                    maxWidth: '420px',
                    height: 'auto',
                    marginBottom: '35px',
                    display: 'block',
                    borderRadius: '8px'
                  }}
                />
                <div style={{
                  position: 'absolute',
                  bottom: '40px',
                  left: '0',
                  right: '0',
                  display: 'flex',
                  justifyContent: 'center',
                  padding: '0 20px',
                  zIndex: 20
                }}>
                  <button 
                    style={{
                      width: '210px', 
                      padding: '15px 24px',
                      background: '#003366',
                      color: '#ffffff',
                      border: '2px solid #ffffff',
                      borderRadius: '32px',
                      fontWeight: 'bold',
                      fontSize: '15px',
                      cursor: 'pointer',
                      boxShadow: '0 5px 15px rgba(0,0,0,0.25)',
                      transition: 'transform 0.2s'
                    }}
                    onClick={handleEnter}
                    onMouseOver={(e) => e.target.style.transform = 'scale(1.03)'}
                    onMouseOut={(e) => e.target.style.transform = 'scale(1)'}
                  >
                    {t.enter}
                  </button>
                </div>
              </div>
            );
          }

          // ‚úÖ BOAS-VINDAS
          if (view === 'welcome') {
            return (
              <div className="welcome-screen">
                <div className="welcome-content">
                  <div className="welcome-logo">
                    <img src="icon-512.png" alt="Vilamoura Select" />
                  </div>
                  <h1 className="welcome-title">{i18n[selectedLang].welcome}</h1>
                  <p className="welcome-text">{i18n[selectedLang].welcomeText}</p>
                  
                  <div style={{marginBottom: '25px'}}>
                    <div className="lang-select-title">{i18n[selectedLang].selectLang}</div>
                    <div className="lang-grid-flags">
                      {languages.map(l => (
                        <div 
                          key={l.code}
                          className={`lang-flag-option ${selectedLang === l.code ? 'selected' : ''}`}
                          onClick={() => setSelectedLang(l.code)}
                          title={l.name}
                        >
                          <img 
                            src={l.flag} 
                            alt={l.name}
                            style={{ 
                              width: '24px', 
                              height: '16px', 
                              objectFit: 'cover', 
                              borderRadius: '2px'
                            }}
                          />
                        </div>
                      ))}
                    </div>
                  </div>
                  
                  <button className="welcome-btn" onClick={handleStart}>
                    {i18n[selectedLang].start}
                  </button>
                  
                  <label className="welcome-checkbox">
                    <input 
                      type="checkbox" 
                      checked={dontShowAgain}
                      onChange={(e) => setDontShowAgain(e.target.checked)}
                    />
                    {i18n[selectedLang].dontShowAgain}
                  </label>
                </div>
              </div>
            );
          }

          // ‚úÖ APP PRINCIPAL
          return (
            <div style={{height: '100%'}}>
              <div className="lang-bar">
                {['pt','en','fr','de','es'].map(l => (
                  <button key={l} className={`lang-btn ${lang === l ? 'active' : ''}`} onClick={() => setLang(l)}>{l.toUpperCase()}</button>
                ))}
              </div>
              <div className="app-content">
                <div className="menu-view" style={{ display: subView !== 'mapa' ? 'block' : 'none' }}>
                    <div className="search-area">
                        <div className="search-box">
                            <i className="fas fa-search"></i>
                            <input type="text" placeholder={t.search} value={query} onChange={(e) => {setQuery(e.target.value); if(subView !== 'grid') setSubView('grid');}} />
                        </div>
                    </div>
                    {error && <div className="error-msg">‚ö†Ô∏è {error}</div>}
                    {loading ? (
                        <div className="loader"><i className="fas fa-spinner fa-spin"></i> {t.loading}</div>
                    ) : query.length > 0 ? (
                        <div>
                            {filtered.length === 0 ? <div style={{padding:'20px', textAlign:'center', color:'#666'}}>Nenhum resultado</div> : null}
                            {filtered.map(l => (
                                <div key={l.id || l.nome} className="item-row" onClick={() => openMap(l)}>
                                    <img src={cleanImageUrl(l.img)} style={{width:50, height:50, borderRadius:8, objectFit:'cover'}} onError={(e) => {e.target.src='https://via.placeholder.com/50?text=?'}} />
                                    <div>
                                        <div style={{fontWeight:'bold'}}>{l.nome}</div>
                                        <div style={{fontSize:11}}>{getInfoText(l.info, lang)}</div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : subView === 'grid' ? (
                        <div>
                            <div className="grid-cats">
                                {CATEGORIAS.map(c => (
                                    <div key={c.id} className="cat-card" onClick={() => { setCatAtiva(c.id); setSubView('lista'); }}>
                                        <i className={`fas ${c.icon}`} style={{fontSize:'24px', color:'#003366'}}></i>
                                        <div style={{fontWeight:'bold', marginTop:5}}>{t.cats[c.id]}</div>
                                    </div>
                                ))}
                            </div>
                            <button className="explore-below-btn" onClick={() => openMap(locais)}>
                                <i className="fas fa-map-marked-alt"></i> {t.explore}
                            </button>
                        </div>
                    ) : (
                        <div>
                            <div style={{ padding: '15px', display: 'flex', gap: '10px', alignItems: 'center', flexWrap: 'wrap' }}>
                                <button onClick={() => setSubView('grid')} style={{ padding: '10px 15px', background: 'none', border: 'none', color: '#003366', fontWeight: 'bold', cursor: 'pointer' }}>‚Üê {t.back}</button>
                            </div>
                            {locais.filter(l => l.cat === catAtiva).map(l => (
                                <div key={l.id || l.nome} className="item-row" onClick={() => openMap(l)}>
                                    <img src={cleanImageUrl(l.img)} style={{width:50, height:50, borderRadius:8, objectFit:'cover'}} onError={(e) => {e.target.src='https://via.placeholder.com/50?text=?'}} />
                                    <div>
                                        <div style={{fontWeight:'bold'}}>{l.nome}</div>
                                        <div style={{fontSize:11}}>{getInfoText(l.info, lang)}</div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
                <div className="map-view" style={{ visibility: subView === 'mapa' ? 'visible' : 'hidden' }}>
                    <button className="btn-back-map" onClick={() => {setSubView('grid'); setQuery('');}}>{t.back}</button>
                    <div ref={mapRef} id="map-canvas"></div>
                </div>
              </div>
            </div>
          );
        }
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>

    <!-- PWA Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then(reg => console.log('‚úÖ Service Worker registado!', reg))
            .catch(err => console.log('‚ùå Erro no Service Worker:', err));
        });
      }
    </script>
</body>
</html>